---
- hosts: localhost
  gather_facts: false
  become: no
  tasks:
    - name: "Check ansible version >=2.7.8"
      assert:
        msg: "Ansible must be v2.7.8 or higher"
        that:
          - ansible_version.string is version("2.7.8", ">=")
      tags:
        - check
  vars:
    ansible_connection: local

- hosts: bastion[0]
  gather_facts: False
  vars:
    TF_VER: 0.12.24
  
  tasks:
    - name: "Create the .kube directory if it does not exist"
      file:
        path: /home/eouser/.kube/
        state: directory
        owner: eouser
        mode: '0755'

    - name: "Copy file kubernetes config file"
      copy:
        src: inventory/cf2-kube/artifacts/admin.conf
        dest: /home/eouser/.kube/config
        owner: eouser
        mode: '0644'

    - name: "Download kubectl v1.18.0"
      get_url:
        url: https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl
        dest: /usr/local/bin/kubectl
        mode: +x 

    - name: "Download Terraform"
      get_url:
        url: https://releases.hashicorp.com/terraform/{{TF_VER}}/terraform_{{TF_VER}}_linux_amd64.zip
        dest: /tmp/terraform.zip

    - name: "Install Terraform"
      unarchive:
        src: /tmp/terraform.zip
        dest: /usr/local/bin
        remote_src: yes
        mode: +x
  